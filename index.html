<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>8-Cell BF Interpreter</title>
    <style>
        body { font-family: 'Courier New', monospace; background: #121212; color: #00ff41; padding: 20px; max-width: 800px; margin: auto; }
        h2 { border-bottom: 1px solid #333; padding-bottom: 10px; }
        label { display: block; margin: 15px 0 5px; font-weight: bold; color: #888; }
        textarea { width: 100%; height: 150px; background: #1a1a1a; color: #00ff41; border: 1px solid #333; padding: 10px; font-size: 1.1em; outline: none; }
        input { width: 100%; padding: 10px; background: #1a1a1a; color: #fff; border: 1px solid #333; box-sizing: border-box; outline: none; }
        button { background: #00ff41; color: #000; border: none; padding: 12px 30px; font-weight: bold; cursor: pointer; margin-top: 15px; width: 100%; }
        button:hover { background: #00cc33; }
        #output-area { margin-top: 25px; background: #000; border: 1px solid #333; padding: 15px; min-height: 60px; }
        #output { white-space: pre-wrap; word-wrap: break-word; color: #fff; }
        .error { color: #ff4444; }
    </style>
</head>
<body>

    <h2>8-CELL INTERPRETER</h2>
    
    <label>Program (Brainfuck):</label>
    <textarea id="code" placeholder="Enter code here...">++++++++++[>+++++++>++++++++++>+++>+<<<<-]>++.>+.+++++++..+++.>++.<<+++++++++++++++.>.+++.------.--------.>+.</textarea>
    
    <label>Input Buffer (for , command):</label>
    <input type="text" id="inputBuffer" placeholder="Type input here...">
    
    <button onclick="runBF()">EXECUTE PROGRAM</button>

    <div id="output-area">
        <strong>Output:</strong><br>
        <div id="output"></div>
    </div>

    <script>
    function runBF() {
        const code = document.getElementById('code').value;
        const outBox = document.getElementById('output');
        let inputArr = document.getElementById('inputBuffer').value.split('').map(c => c.charCodeAt(0));
        
        outBox.innerText = 'Running...';
        outBox.className = '';

        const MEM_SIZE = 8;
        const memory = new Uint8Array(MEM_SIZE);
        let ptr = 0;
        let pc = 0;
        let output = "";
        
        // Safety switch to prevent browser freezing
        let iterations = 0;
        const MAX_ITERATIONS = 500000; 

        // 1. Pre-map Jumps (Loops)
        const stack = [];
        const jumps = {};
        for (let i = 0; i < code.length; i++) {
            if (code[i] === '[') stack.push(i);
            else if (code[i] === ']') {
                if (stack.length === 0) {
                    outBox.innerText = "Syntax Error: Unmatched ']'";
                    outBox.className = 'error';
                    return;
                }
                let start = stack.pop();
                jumps[start] = i;
                jumps[i] = start;
            }
        }
        if (stack.length > 0) {
            outBox.innerText = "Syntax Error: Unmatched '['";
            outBox.className = 'error';
            return;
        }

        // 2. Execute
        while (pc < code.length) {
            iterations++;
            if (iterations > MAX_ITERATIONS) {
                outBox.innerText = "Error: Infinite loop detected (Exceeded 500,000 steps).";
                outBox.className = 'error';
                return;
            }

            switch (code[pc]) {
                case '>': ptr = (ptr + 1) % MEM_SIZE; break;
                case '<': ptr = (ptr - 1 + MEM_SIZE) % MEM_SIZE; break;
                case '+': memory[ptr]++; break;
                case '-': memory[ptr]--; break;
                case '.': output += String.fromCharCode(memory[ptr]); break;
                case ',': memory[ptr] = inputArr.length > 0 ? inputArr.shift() : 0; break;
                case '[': if (memory[ptr] === 0) pc = jumps[pc]; break;
                case ']': if (memory[ptr] !== 0) pc = jumps[pc]; break;
            }
            pc++;
        }

        outBox.innerText = output || "[Program finished with no output]";
    }
    </script>
</body>
</html>
